#!/bin/bash
alias rk="echo '** Running Specs.' ; rake | tee ~/t | grep '^F '"
alias dbm="rake db:migrate ; rake db:migrate RAILS_ENV=test ; rake db:migrate RAILS_ENV=test_master"
alias rakess="rake eol:site_specific repo=git@github.com:mbl-cli/eol-private.git";
alias sp="rescue rspec spec/models/ spec/controllers/ spec/helpers/ spec/lib/ spec/views/"
alias zs="zeus test spec/models/ spec/controllers/ spec/helpers/ spec/lib/ spec/views/"
alias top="top -o cpu"
alias mt='git mergetool'
alias gcp='git cherry-pick'
# Used when cherry-picking, and mergetool changes are successful:
alias ccp='git clean -f; git commit -m "Merge after cherry-pick"; git push'
alias restage='cap staging unicorn:stop ; cap staging unicorn:stop ; cap staging deploy:restart'
alias rebocce='cap bocce_demo unicorn:stop ; cap bocce_demo unicorn:stop ; cap bocce_demo deploy:restart'
alias eol='cd ~/eol'
alias z='cd ~/eol; zeus start'
alias sc='eol;rails c'
alias zc='eol;zeus c'
alias en='eol;vim config/translations/en.yml'
alias guard='eol;bundle exec guard'
alias newtodos='git diff master | grep "+.*TODO"'
alias ealias='vim ~/.bash_aliases_local ; source ~/.bash_aliases_local'
alias rcstat='cd ~/chef/rc ; knife status'
alias mblstat='cd ~/chef/mbl ; knife status'

# SSH aliases:
alias stage='ssh eol_staging_deploy@staging.eol.org'
alias bocce='ssh eol_staging_deploy@bocce.eol.org'
alias stagesolr='ssh root@128.128.170.4'
alias beast='ssh eol-thebeast.rc.fas.harvard.edu'
alias services='ssh services.eol.org'
alias app1='echo Should just get in; ssh eol-app1'
alias backup='ssh -t backup1.core.cli.mbl.edu "cd /backup ; bash"'

alias p="echo '** Running PHP Tests...' ; cd ~/eol;rake solr:start;cd ~/php_code; php tests/run_tests.php | tee ~/p | grep '^Exception '"
alias s="rails s"
alias zs="cd ~/eol; zeus rake solr:start ; zeus s"
alias c="rails c"
# I know this is weird, having it run in the foreground, but then backgrounding it... but it puts the output in the right place:
alias virtu="cd /usr/local/virtuoso-opensource/var/lib/virtuoso/db;virtuoso-t +foreground &"
alias virtusql="cd /usr/local/virtuoso-opensource; ./bin/isql 1111 dba dba"
alias bill="cd ~/bin ; ruby calc_bills.rb"

function gcp() {
  git cherry-pick $1;
  git mergetool;
}

function capbocce() {
  git pull;
  git rebase -i @{u};
  git push;
  git tag $1;
  git push --tags;
  rake eol:site_specific;
  cap bocce_demo unicorn:stop;
  cap bocce_demo unicorn:stop;
  cap bocce_demo deploy -S tag=$1
  echo "Tag: $1";
}

function capstage() {
  git pull;
  git rebase -i @{u};
  git push;
  git tag $1;
  git push --tags;
  rake eol:site_specific;
  cap staging unicorn:stop;
  cap staging unicorn:stop;
  cap staging deploy -S tag=$1
  echo "Tag: $1";
}

function just_branch() {
  git branch $1;
  git push origin $1;
  git branch -D $1;
  git checkout $1;
  git tag $1.01;
}
function branch() {
  just_branch $1;
  capbocce $1.01;
}
